<!doctype html>
<html>
   <head>
       <meta charset="utf-8">
       <meta name="viewport" content="width=device-width, initial-scale=1">
       <link rel="shortcut icon" href="../favicon.ico" />
       <title>px-simple-line-chart Demo</title>
       <!-- Requires Webcomponents.js polyfill is provided by the page for browsers that don't support html imports -->
       <script src="../bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
       <script src="../web-component-tester/browser.js"></script>

       <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

       <!-- Import custom element. Note: see comment about relative paths to dependencies in the *.html file referenced below -->
       <link rel="import" href="../px-simple-bar-chart.html" />
   </head>
   <body>


 <px-simple-bar-chart id="fixture1" chart-data="[ [1,2,3] ]">
</px-simple-bar-chart>

<px-simple-bar-chart id="fixture2" height="200" chart-data="[ [1,2,3] ]">
</px-simple-bar-chart>

<px-simple-bar-chart id="fixture3">&hearts;</px-simple-bar-chart>

<div id="fixture_dimensions" style="width:300px; height:200px;">
    <px-simple-bar-chart height="auto" width="auto" id="fixture4">&hearts;</px-simple-bar-chart>
</div>

<style is="custom-style">
  :root #fixture5 {
    --px-vis-series-color-0: rgb(1,2,3);
    --px-vis-series-color-1: rgb(4,5,6);
    --px-vis-series-color-2: rgb(7,8,9);
    --px-vis-series-color-3: rgb(10,11,12);
    --px-vis-series-color-4: rgb(255,255,0);
  }
</style>
<px-simple-bar-chart id="fixture5">&hearts;</px-simple-bar-chart>

<style is="custom-style">
  :root #fixture6 {
    --px-vis-series-color-0: rgb(1,2,3);
    --px-vis-series-color-1: rgb(4,5,6);
    --px-vis-series-color-2: rgb(7,8,9);
    --px-vis-series-color-3: rgb(10,11,12);
    --px-vis-series-color-4: rgb(255,255,0);
  }
</style>
<px-simple-bar-chart id="fixture6" colors='["#aaa","#bbb","#ccc","#ddd","#eee"]'>&hearts;</px-simple-bar-chart>

  <script>

  test('fixture exists', function(done) {
   var fixture = document.getElementById("fixture1");

   setTimeout(function(){

   assert.equal(getComputedStyle(document.querySelector('rect')).visibility,"visible");
   done();
   },1000);

 });

 test('fixture height is 150', function(done) {
   var fixture = document.getElementById("fixture1");


  assert.equal(getComputedStyle(fixture.querySelector('svg')).height,"150px");
   done();

 });

 test('fixture2 height is 200', function(done) {
   var fixture = document.getElementById("fixture2");


  assert.equal(getComputedStyle(fixture.querySelector('svg')).height,"200px");
   done();

 });

 test('fixture1 SVG element has default width', function(done) {
   var fixture = document.getElementById("fixture1");

   assert.equal(getComputedStyle(fixture.querySelector('svg')).width,"285px");
   done();

 });

 test('fixture1 SVG element has default height', function(done) {
   var fixture = document.getElementById("fixture1");

   assert.equal(getComputedStyle(fixture.querySelector('svg')).height,"150px");
   done();

 });

 test('fixture3 SVG element has default width', function(done) {
   var fixture = document.getElementById("fixture1");

   assert.equal(getComputedStyle(fixture.querySelector('svg')).width,"285px");
   done();

 });

 test('fixture3 count all rectangle in chart equals the data array', function(done) {
   var fixture = document.getElementById("fixture3");
   var svg = fixture.querySelector('svg');

   assert.equal(svg.querySelectorAll('rect').length,"40");
   done();

 });

 test('fixture3 colors of chart should match default colors', function(done) {
   var fixture = document.getElementById("fixture3");
   var svg = fixture.querySelector('svg');
   var rect = svg.querySelectorAll('rect');
   var is_firechrome = (navigator.userAgent.toLowerCase().indexOf('chrome') > -1 ||
    navigator.userAgent.toLowerCase().indexOf('firefox') > -1) && navigator.userAgent.toLowerCase().indexOf('edge') === -1;

    // Normalizes RGB colors by stripping all whitespaces
    var normalizeRgb = function(rgbString) { return rgbString.toString().replace(/\s+/g, '') };

    // Get normalized RGB fill from `svg.querySelectorAll('rect')` at `num` index
    var getFill = function(num) { return normalizeRgb(getComputedStyle(rect[num]).fill) };

    // Determine which colors should be set on the chart by calling `_getColor` to retrieve theme, normalize each
    var colors = [
      normalizeRgb(fixture._getColor(0)),
      normalizeRgb(fixture._getColor(1)),
      normalizeRgb(fixture._getColor(2)),
      normalizeRgb(fixture._getColor(3)),
      normalizeRgb(fixture._getColor(4))
    ];

    if(!is_firechrome)
    {
      assert.equal(getFill(5), colors[0]);
      assert.equal(getFill(12),colors[1]);
      assert.equal(getFill(19),colors[2]);
      assert.equal(getFill(26),colors[3]);
      assert.equal(getFill(33),colors[4]);
      done();
    } else{
      assert.equal(getFill(5), colors[0]);
      assert.equal(getFill(12),colors[1]);
      assert.equal(getFill(19),colors[2]);
      assert.equal(getFill(26),colors[3]);
      assert.equal(getFill(33),colors[4]);
      done();
    }
 });

 test('fixture3 legend is present', function(done) {
   var fixture = document.getElementById("fixture3");
   var svg = fixture.querySelector('svg');
   var rect = svg.querySelectorAll('rect');

   assert.isTrue(rect[0].className.baseVal.indexOf('legend-box') !== -1);
   assert.isTrue(rect[1].className.baseVal.indexOf('legend-box') !== -1);
   assert.isTrue(rect[2].className.baseVal.indexOf('legend-box') !== -1);
   assert.isTrue(rect[3].className.baseVal.indexOf('legend-box') !== -1);
   assert.isTrue(rect[4].className.baseVal.indexOf('legend-box') !== -1);
   done();
 });

 test('fixture5 colors should match applied CSS custom properties', function(done) {
   var fixture = document.getElementById("fixture5");
   var svg = fixture.querySelector('svg');
   var rect = svg.querySelectorAll('rect');
   var is_firechrome = (navigator.userAgent.toLowerCase().indexOf('chrome') > -1 ||
   navigator.userAgent.toLowerCase().indexOf('firefox') > -1) && navigator.userAgent.toLowerCase().indexOf('edge') === -1;

   // Normalizes RGB colors by stripping all whitespaces
   var normalizeRgb = function(rgbString) { return rgbString.toString().replace(/\s+/g, '') };

   // Get normalized RGB fill from `svg.querySelectorAll('rect')` at `num` index
   var getFill = function(num) { return normalizeRgb(getComputedStyle(rect[num]).fill) };

   // Just copy and pasting the RGB values from above into strings to test that
   // the colors the user provides are actually provided, not just that the
   // the internal `_getColor` method returns what it shoudl
   var colors = [
    normalizeRgb('rgb(1,2,3)'),
    normalizeRgb('rgb(4,5,6)'),
    normalizeRgb('rgb(7,8,9)'),
    normalizeRgb('rgb(10,11,12)'),
    normalizeRgb('rgb(255,255,0)')
   ];

   assert.equal(getFill(5), colors[0]);
   assert.equal(getFill(12),colors[1]);
   assert.equal(getFill(19),colors[2]);
   assert.equal(getFill(26),colors[3]);
   assert.equal(getFill(33),colors[4]);
   done();
 });

 test('fixture6 attribute colors override applied CSS custom properties', function(done) {
   var fixture = document.getElementById("fixture6");
   var svg = fixture.querySelector('svg');
   var rect = svg.querySelectorAll('rect');
   var is_firechrome = (navigator.userAgent.toLowerCase().indexOf('chrome') > -1 ||
   navigator.userAgent.toLowerCase().indexOf('firefox') > -1) && navigator.userAgent.toLowerCase().indexOf('edge') === -1;

   // Normalizes RGB colors by stripping all whitespaces
   var normalizeRgb = function(rgbString) { return rgbString.toString().replace(/\s+/g, '') };

   // Get normalized RGB fill from `svg.querySelectorAll('rect')` at `num` index
   var getFill = function(num) { return normalizeRgb(getComputedStyle(rect[num]).fill) };

   // Just copy and pasting the RGB values from above into strings to test that
   // the colors the user provides are actually provided, not just that the
   // the internal `_getColor` method returns what it shoudl
   var colors = [
    normalizeRgb(fixture._colorHexToRgb('#aaa')),
    normalizeRgb(fixture._colorHexToRgb('#bbb')),
    normalizeRgb(fixture._colorHexToRgb('#ccc')),
    normalizeRgb(fixture._colorHexToRgb('#ddd')),
    normalizeRgb(fixture._colorHexToRgb('#eee'))
   ];

   assert.equal(getFill(5), colors[0]);
   assert.equal(getFill(12),colors[1]);
   assert.equal(getFill(19),colors[2]);
   assert.equal(getFill(26),colors[3]);
   assert.equal(getFill(33),colors[4]);
   done();
 });



 test('fixture4 SVG element has assigned width', function(done) {
   var fixture = document.getElementById("fixture4");

   assert.equal(getComputedStyle(fixture.querySelector('svg')).width,"299px");
   done();

 });

 test('fixture4 SVG element has assigned height', function(done) {
   var fixture = document.getElementById("fixture4");

   assert.equal(getComputedStyle(fixture.querySelector('svg')).height,"200px");
   done();

 });

 test('fixture4 test for resize chart by height', function(done) {
   var fixture = document.getElementById("fixture4");

   document.getElementById('fixture_dimensions').style.height = '270px';
   window.dispatchEvent(new Event('resize'));
   setTimeout(function(){
   assert.equal(getComputedStyle(fixture.querySelector('svg')).height,"270px");
   done();
   },1000);

 });

 test('fixture4 test for resize chart by width', function(done) {
   var fixture = document.getElementById("fixture4");


   document.getElementById('fixture_dimensions').style.width = '400px';
   window.dispatchEvent(new Event('resize'));
   setTimeout(function(){
   assert.equal(getComputedStyle(fixture.querySelector('svg')).width,"403px");
   done();
 },1000);

 });
  </script>

       </body>
       </html>
